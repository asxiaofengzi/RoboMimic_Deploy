# G1机器人键盘控制说明

## 概述
本项目现在支持键盘控制，作为手柄控制的替代方案。键盘控制器通过pygame库实现，提供与手柄相同的功能。

## 安装依赖
```bash
pip install -r requirements.txt
```

## 启动方式

### 1. 使用批处理脚本 (推荐)
双击 `start_simulation.bat` 文件，选择相应的控制模式。

### 2. 命令行启动
```bash
# 键盘控制模式
python deploy_mujoco/deploy_mujoco_keyboard.py --controller keyboard

# 手柄控制模式 
python deploy_mujoco/deploy_mujoco_keyboard.py --controller joystick

# 原始手柄控制
python deploy_mujoco/deploy_mujoco.py
```

### 3. 测试键盘控制器
```bash
python test_keyboard.py
```

## 键盘控制映射

### 基础按键
| 键盘按键 | 手柄对应 | 功能说明 |
|---------|---------|---------|
| R | R1 | 右肩键 |
| L | L1 | 左肩键 |
| Enter | Start | 开始键 |
| Esc | Select | 选择键 |
| J | A | A键 |
| K | B | B键 |
| I | X | X键 |
| U | Y | Y键 |
| ↑↓←→ | 方向键 | 十字键 |
| F1 | F1 | 紧急保护 |

### 摇杆控制
| 键盘按键 | 摇杆轴 | 功能说明 |
|---------|--------|---------|
| W | 左摇杆上 | 机器人前进 |
| S | 左摇杆下 | 机器人后退 |
| A | 左摇杆左 | 机器人左移 |
| D | 左摇杆右 | 机器人右移 |
| Q | 右摇杆左 | 机器人左转 |
| E | 右摇杆右 | 机器人右转 |
| Z | 右摇杆上 | 机器人俯仰向前 |
| C | 右摇杆下 | 机器人俯仰向后 |

## 控制命令

### 模式切换组合键
| 组合键 | 功能 | 适用环境 |
|--------|------|----------|
| R + X | 舞蹈模式 | ✅ 真机推荐 |
| R + A | 行走模式 | ✅ 真机推荐 |
| R + Y | 武术动作 | ⚠️ 仅仿真推荐 |
| R + B | 踢腿动作 | ⚠️ 仅仿真推荐 |
| L + Y | 失败武术 | ⚠️ 仅仿真推荐 |
| Enter | 位控恢复 | ✅ 真机推荐 |
| Esc | 阻尼保护 | ✅ 真机推荐 |
| F1 | 紧急保护 | ✅ 重要安全功能 |

### 控制技巧
1. **组合键操作**: 先按住R或L键，再按功能键
2. **摇杆控制**: 可以同时使用多个方向键
3. **连续控制**: 按住方向键可以持续控制
4. **紧急停止**: 随时按F1键进入保护模式

## 注意事项

### 安全提醒
⚠️ **重要**: 
- 仅适用于3自由度腰部的G1机器人
- 建议移除手掌避免干涉
- 务必先在仿真中熟练操作再尝试真机
- 查尔斯顿舞蹈是唯一验证稳定的真机策略

### 使用建议
1. **窗口焦点**: 确保pygame窗口保持活动状态以接收键盘输入
2. **帮助信息**: 在pygame窗口中按H键可查看控制帮助
3. **调试模式**: 使用测试脚本验证键盘输入是否正常
4. **备选方案**: 键盘控制器初始化失败时会自动尝试手柄控制

### 故障排除
1. **pygame未安装**: 运行 `pip install pygame`
2. **控制无响应**: 检查pygame窗口是否为活动窗口
3. **按键映射错误**: 参考本文档的按键映射表
4. **程序崩溃**: 尝试先运行测试脚本检查键盘控制器

## 文件说明
- `keyboard_controller.py`: 键盘控制器核心实现
- `deploy_mujoco_keyboard.py`: 支持键盘的仿真部署文件
- `test_keyboard.py`: 键盘控制器测试脚本
- `start_simulation.bat`: Windows启动脚本
- `requirements.txt`: Python依赖包列表

## 技术细节
键盘控制器通过pygame库实现，提供与手柄相同的接口:
- `is_button_pressed()`: 检测按键状态
- `is_button_released()`: 检测按键释放
- `get_axis_value()`: 获取摇杆值
- `set()`: 更新控制器状态

控制器适配器(`ControllerAdapter`)统一了不同输入设备的接口，使得切换控制方式变得简单。
